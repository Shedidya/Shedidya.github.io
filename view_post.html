{% extends "base.html" %}

{% block title %}Post by {{ post.author.username }} - HMAgram{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Post Card -->
            <div class="post-card">
                <!-- Post Header -->
                <div class="post-header">
                    <div class="d-flex align-items-center">
                        <div class="avatar">
                            {% if post.author.profile_image %}
                                <img src="{{ url_for('uploaded_file', filename=post.author.profile_image) }}" alt="{{ post.author.username }}" class="avatar-image">
                            {% else %}
                                <i data-feather="user"></i>
                            {% endif %}
                        </div>
                        <div class="ms-3">
                            <h6 class="mb-0">
                                <a href="{{ url_for('profile', username=post.author.username) }}" class="text-decoration-none">
                                    {{ post.author.username }}
                                </a>
                            </h6>
                            <small class="text-muted">{{ post.created_at.strftime('%b %d, %Y at %I:%M %p') }}</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <span class="badge category-badge category-{{ post.get_category_name().lower() }}">
                            {{ post.get_category_name() }}
                        </span>
                        {% if current_user.is_authenticated and (current_user.id == post.user_id or current_user.is_admin) %}
                            <form action="{{ url_for('delete_post', post_id=post.id) }}" method="post" style="display: inline;" 
                                  onsubmit="return confirm('Are you sure you want to delete this post?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i data-feather="trash-2"></i>
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Post Image -->
                <div class="post-image">
                    <img src="{{ url_for('uploaded_file', filename=post.image_filename) }}" 
                         alt="Post image" class="img-fluid">
                </div>
                
                <!-- Post Actions -->
                <div class="post-actions">
                    <div class="d-flex gap-3">
                        {% if current_user.is_authenticated %}
                            <a href="{{ url_for('like_post', post_id=post.id) }}" class="action-btn">
                                <i data-feather="{{ 'heart' if not post.is_liked_by(current_user) else 'heart' }}" 
                                   class="{{ 'text-danger' if post.is_liked_by(current_user) else '' }}"></i>
                                {% if current_user.is_admin %}
                                    <span>{{ post.like_count() }}</span>
                                {% endif %}
                            </a>
                        {% else %}
                            <span class="action-btn">
                                <i data-feather="heart"></i>
                            </span>
                        {% endif %}
                        <span class="action-btn">
                            <i data-feather="message-circle"></i>
                            <span>{{ comments|length }}</span>
                        </span>
                    </div>
                </div>
                
                <!-- Post Content -->
                <div class="post-content">
                    {% if post.caption %}
                        <p class="mb-2">
                            <strong>{{ post.author.username }}</strong> {{ post.caption }}
                        </p>
                    {% endif %}
                    {% if post.hashtags %}
                        <p class="hashtags mb-3">{{ post.hashtags }}</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Comments Section -->
            <div class="comments-section mt-4">
                <h5 class="mb-3">Comments</h5>
                
                <!-- Add Comment Form -->
                {% if current_user.is_authenticated %}
                    <div class="comment-form mb-4">
                        <form action="{{ url_for('add_comment', post_id=post.id) }}" method="post">
                            {{ comment_form.hidden_tag() }}
                            <div class="mb-3">
                                {{ comment_form.content(class="form-control", rows="2") }}
                            </div>
                            <div class="text-end">
                                {{ comment_form.submit(class="btn btn-primary btn-sm") }}
                            </div>
                        </form>
                    </div>
                {% endif %}
                
                <!-- Comments List -->
                {% if comments %}
                    <div class="comments-list">
                        {% for comment in comments %}
                            <div class="comment-item">
                                <div class="d-flex">
                                    <div class="avatar-sm me-3">
                                        <i data-feather="user"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="comment-content">
                                            <strong>
                                                <a href="{{ url_for('profile', username=comment.author.username) }}" class="text-decoration-none">
                                                    {{ comment.author.username }}
                                                </a>
                                            </strong>
                                            <span class="ms-2">{{ comment.content }}</span>
                                        </div>
                                        <small class="text-muted">{{ comment.created_at.strftime('%b %d, %Y at %I:%M %p') }}</small>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4 text-muted">
                        <i data-feather="message-circle" class="mb-2"></i>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                {% endif %}
            </div>
            
            <!-- Back to feed -->
            <div class="text-center mt-4">
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                    <i data-feather="arrow-left" class="me-2"></i>Back to Feed
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.comment-item {
    background: white;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.avatar-sm {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: var(--light-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    flex-shrink: 0;
}

.avatar-sm i {
    width: 16px;
    height: 16px;
}

.comment-form {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.comments-section {
    margin-bottom: 40px;
}
</style>
{% endblock %}
